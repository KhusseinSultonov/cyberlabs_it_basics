<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Передача данных с MAC-адресами</title>
    <style>
        :root {
            --primary: #00ffaa;
            --secondary: #0099ff;
            --error: #ff3366;
            --bg-dark: #0f0f1a;
            --device-bg: #1a1a2e;
            --disabled: #33334a;
            --fiber-color: #ff9900;
            --utp-color: #0099ff;
            --mac-color: #aa00ff;
            --header-bg: rgba(0, 0, 0, 0.3);
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--bg-dark);
            color: white;
            overflow-x: hidden;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(0, 255, 170, 0.3);
        }
        .subtitle {
            color: var(--secondary);
            font-size: 1.2rem;
        }
        .network-container {
            position: relative;
            height: 400px;
            margin: 50px 0;
            perspective: 1000px;
        }
        .network-rail {
            position: absolute;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, #252540, #3a3a5a);
            top: 50%;
            transform: translateY(-50%);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 153, 255, 0.2);
            transition: all 0.3s;
        }
        .network-rail.fiber {
            background: linear-gradient(90deg, #3a2a00, #5a4a20);
            box-shadow: 0 0 20px rgba(255, 153, 0, 0.3);
        }
        .device {
            position: absolute;
            width: 170px;
            height: 130px;
            background: var(--device-bg);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
            z-index: 10;
            border: 2px solid #2a2a4a;
            cursor: pointer;
        }
        .device:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 153, 255, 0.3);
        }
        .device.disabled {
            background: var(--disabled);
            opacity: 0.6;
            border-color: var(--error);
        }
        .device.disabled .device-icon {
            opacity: 0.5;
        }
        .device-icon {
            font-size: 40px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        .device-label {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .device-mac {
            font-size: 12px;
            color: var(--mac-color);
            font-family: monospace;
            margin-top: 5px;
        }
        .packet {
            position: absolute;
            width: 100px;
            height: 80px;
            background: rgba(0, 255, 170, 0.2);
            border-radius: 8px;
            border: 2px solid var(--primary);
            z-index: 5;
            opacity: 0;
            display: flex;
            flex-direction: column;
            padding: 0;
            box-shadow: 0 0 20px rgba(0, 255, 170, 0.3);
            transition: left 0.5s linear;
            overflow: hidden;
        }
        .packet.error {
            border-color: var(--error);
            box-shadow: 0 0 20px rgba(255, 51, 102, 0.3);
        }
        .packet-header {
            background: var(--header-bg);
            padding: 5px;
            font-size: 9px;
            color: var(--mac-color);
            font-family: monospace;
            display: flex;
            flex-direction: column;
            gap: 2px;
            border-bottom: 1px solid var(--primary);
        }
        .mac-row {
            display: flex;
            align-items: center;
        }
        .mac-label {
            width: 30px;
            color: var(--primary);
            font-weight: bold;
        }
        .mac-value {
            flex-grow: 1;
        }
        .packet-bits {
            display: flex;
            justify-content: center;
            gap: 3px;
            padding: 5px;
            flex-wrap: wrap;
        }
        .bit {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: bold;
            color: black;
        }
        .bit.error {
            background: var(--error);
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        .btn {
            padding: 15px 30px;
            border-radius: 50px;
            border: none;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .btn-primary {
            background: var(--primary);
            color: #111;
            box-shadow: 0 5px 15px rgba(0, 255, 170, 0.4);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 255, 170, 0.6);
        }
        .btn-secondary {
            background: transparent;
            color: var(--secondary);
            border: 2px solid var(--secondary);
        }
        .btn-secondary:hover {
            background: rgba(0, 153, 255, 0.1);
        }
        .btn-danger {
            background: transparent;
            color: var(--error);
            border: 2px solid var(--error);
        }
        .btn-danger:hover {
            background: rgba(255, 51, 102, 0.1);
        }
        .connection-type {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .connection-btn {
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 153, 255, 0.1);
            color: var(--secondary);
            border: 2px solid var(--secondary);
        }
        .connection-btn.active {
            background: var(--secondary);
            color: #111;
        }
        .connection-btn.fiber {
            color: var(--fiber-color);
            border: 2px solid var(--fiber-color);
        }
        .connection-btn.fiber.active {
            background: var(--fiber-color);
            color: #111;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            background: rgba(26, 26, 46, 0.7);
            padding: 20px;
            border-radius: 15px;
            margin-top: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid #2a2a4a;
            flex-wrap: wrap;
        }
        .stat {
            text-align: center;
            min-width: 150px;
            margin: 10px;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stat-label {
            color: #a0a0c0;
            font-size: 14px;
        }
        .pulse-effect {
            position: absolute;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, transparent, var(--secondary), transparent);
            top: 0;
            opacity: 0;
            animation: pulse 4s infinite;
        }
        .pulse-effect.fiber {
            background: linear-gradient(90deg, transparent, var(--fiber-color), transparent);
            animation: pulse 2s infinite;
        }
        .device-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .device-btn {
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 153, 255, 0.1);
            color: var(--secondary);
            border: 2px solid var(--secondary);
        }
        .device-btn.active {
            background: var(--secondary);
            color: #111;
        }
        .device-btn.disabled-btn {
            border-color: var(--error);
            color: var(--error);
        }
        .device-btn.disabled-btn.active {
            background: var(--error);
            color: #111;
        }
        @keyframes pulse {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 0.7; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .pc { left: 5%; top: 50%; transform: translateY(-50%); }
        .switch { left: 25%; top: 50%; transform: translateY(-50%); }
        .router { left: 50%; top: 50%; transform: translateY(-50%); }
        .firewall { left: 75%; top: 50%; transform: translateY(-50%); }
        .server { left: 95%; top: 50%; transform: translateY(-50%); }
        
        /* Новые стили для информации о пакете */
        .packet-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(26, 26, 46, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--secondary);
            max-width: 300px;
            z-index: 100;
        }
        .packet-info h3 {
            margin-top: 0;
            color: var(--primary);
        }
        .packet-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        .close-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Биты и кадры</h1>
        </header>
        
        <div class="connection-type">
            <button class="connection-btn active" data-type="utp">Витая пара (UTP)</button>
            <button class="connection-btn fiber" data-type="fiber">Оптоволокно</button>
        </div>
        
        <div class="device-controls">
            <button class="device-btn" data-device="switch">Коммутатор</button>
            <button class="device-btn" data-device="router">Маршрутизатор</button>
            <button class="device-btn" data-device="firewall">Firewall</button>
            <button class="device-btn disabled-btn" data-device="error">Режим ошибок</button>
        </div>
        
        <div class="network-container">
            <div class="network-rail" id="networkRail">
                <div class="pulse-effect" id="pulseEffect"></div>
            </div>
            
            <!-- Устройства с MAC-адресами -->
            <div class="device pc" data-device="pc">
                <div class="device-icon">💻</div>
                <div class="device-label">КЛИЕНТ</div>
                <div class="device-mac">MAC: 00:1A:2B:3C:4D:5E</div>
            </div>
            
            <div class="device switch" data-device="switch">
                <div class="device-icon">🔀</div>
                <div class="device-label">КОММУТАТОР</div>
                <div class="device-mac">MAC: 00:1A:2B:3C:4D:5F</div>
            </div>
            
            <div class="device router" data-device="router">
                <div class="device-icon">🔄</div>
                <div class="device-label">МАРШРУТИЗАТОР</div>
                <div class="device-mac">MAC: 00:1A:2B:3C:4D:60</div>
            </div>
            
            <div class="device firewall" data-device="firewall">
                <div class="device-icon">🛡️</div>
                <div class="device-label">FIREWALL</div>
                <div class="device-mac">MAC: 00:1A:2B:3C:4D:61</div>
            </div>
            
            <div class="device server" data-device="server">
                <div class="device-icon">🖥️</div>
                <div class="device-label">СЕРВЕР</div>
                <div class="device-mac">MAC: 00:1A:2B:3C:4D:62</div>
            </div>
            
            <!-- Пакеты -->
            <div class="packet" id="packet1"></div>
            <div class="packet" id="packet2"></div>
            <div class="packet" id="packet3"></div>
        </div>
        
        <div class="controls">
            <button class="btn btn-primary" id="startBtn">
                <span>▶️</span> ЗАПУСТИТЬ ПЕРЕДАЧУ
            </button>
            <button class="btn btn-secondary" id="stopBtn">
                <span>⏹️</span> ОСТАНОВИТЬ
            </button>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="packetsSent">0</div>
                <div class="stat-label">ПАКЕТОВ ОТПРАВЛЕНО</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="packetsReceived">0</div>
                <div class="stat-label">ПАКЕТОВ ПОЛУЧЕНО</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="speed">0</div>
                <div class="stat-label">ПАКЕТОВ/СЕК</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="errors">0</div>
                <div class="stat-label">ОШИБОК</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="latency">0</div>
                <div class="stat-label">ЗАДЕРЖКА (МС)</div>
            </div>
        </div>
        
        <!-- Блок информации о пакете -->
        <div class="packet-info" id="packetInfo" style="display: none;">
            <button class="close-btn" id="closeInfo">×</button>
            <h3>Информация о пакете</h3>
            <p><strong>Отправитель:</strong> <span id="info-from">-</span></p>
            <p><strong>Получатель:</strong> <span id="info-to">-</span></p>
            <p><strong>Данные:</strong> <span id="info-bits">-</span></p>
            <p><strong>Статус:</strong> <span id="info-status">-</span></p>
            <p><strong>Время передачи:</strong> <span id="info-time">-</span> мс</p>
        </div>
    </div>

    <script>
        // MAC-адреса устройств
        const macAddresses = {
            pc: '00:1A:2B:3C:4D:5E',
            switch: '00:1A:2B:3C:4D:5F',
            router: '00:1A:2B:3C:4D:60',
            firewall: '00:1A:2B:3C:4D:61',
            server: '00:1A:2B:3C:4D:62'
        };

        // Элементы
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const connectionBtns = document.querySelectorAll('.connection-btn');
        const deviceBtns = document.querySelectorAll('.device-btn');
        const packets = [
            document.getElementById('packet1'),
            document.getElementById('packet2'),
            document.getElementById('packet3')
        ];
        const devices = {
            pc: document.querySelector('.pc'),
            switch: document.querySelector('.switch'),
            router: document.querySelector('.router'),
            firewall: document.querySelector('.firewall'),
            server: document.querySelector('.server')
        };
        const networkRail = document.getElementById('networkRail');
        const pulseEffect = document.getElementById('pulseEffect');
        const stats = {
            packetsSent: document.getElementById('packetsSent'),
            packetsReceived: document.getElementById('packetsReceived'),
            speed: document.getElementById('speed'),
            errors: document.getElementById('errors'),
            latency: document.getElementById('latency')
        };
        const packetInfo = document.getElementById('packetInfo');
        const closeInfo = document.getElementById('closeInfo');
        
        // Состояние
        let isRunning = false;
        let connectionType = 'utp';
        let errorMode = false;
        let disabledDevices = [];
        let totalPacketsSent = 0;
        let totalPacketsReceived = 0;
        let errorCount = 0;
        let speedCount = 0;
        let animationSpeed = 5000; // Увеличено для замедления анимации
        let animationInterval;
        let speedInterval;
        let currentPacketInfo = null;
        
        // Генератор случайных пакетов с MAC-адресами
        function generateRandomPacket(fromDevice, toDevice) {
            const packetLength = 5 + Math.floor(Math.random() * 3); // 5-7 бит
            let packetBits = '';
            
            for (let i = 0; i < packetLength; i++) {
                packetBits += Math.random() > 0.5 ? '1' : '0';
            }
            
            return {
                fromMac: macAddresses[fromDevice],
                toMac: macAddresses[toDevice],
                bits: packetBits,
                fromDevice: fromDevice,
                toDevice: toDevice
            };
        }
        
        // Показать информацию о пакете
        function showPacketInfo(packetData, status, time) {
            document.getElementById('info-from').textContent = `${devices[packetData.fromDevice].querySelector('.device-label').textContent} (${packetData.fromMac})`;
            document.getElementById('info-to').textContent = `${devices[packetData.toDevice].querySelector('.device-label').textContent} (${packetData.toMac})`;
            document.getElementById('info-bits').textContent = packetData.bits;
            document.getElementById('info-status').textContent = status;
            document.getElementById('info-time').textContent = time;
            packetInfo.style.display = 'block';
            
            // Автоматическое скрытие через 5 секунд
            currentPacketInfo = setTimeout(() => {
                packetInfo.style.display = 'none';
            }, 5000);
        }
        
        // Обновление типа соединения
        function updateConnectionType(type) {
            connectionType = type;
            
            if (type === 'fiber') {
                networkRail.classList.add('fiber');
                pulseEffect.classList.add('fiber');
                animationSpeed = 3000; // Оптоволокно быстрее, но все равно медленно
            } else {
                networkRail.classList.remove('fiber');
                pulseEffect.classList.remove('fiber');
                animationSpeed = 5000; // UTP медленнее
            }
            
            if (isRunning) {
                stopTransmission();
                startTransmission();
            }
        }
        
        // Управление устройствами
        deviceBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const device = btn.dataset.device;
                
                if (device === 'error') {
                    errorMode = !errorMode;
                    btn.classList.toggle('active');
                    return;
                }
                
                if (disabledDevices.includes(device)) {
                    disabledDevices = disabledDevices.filter(d => d !== device);
                    devices[device].classList.remove('disabled');
                    btn.classList.remove('active');
                } else {
                    disabledDevices.push(device);
                    devices[device].classList.add('disabled');
                    btn.classList.add('active');
                }
            });
        });
        
        // Анимация пакета
        function animatePacket(packet) {
            if (!isRunning) return;
            
            // Определяем направление (клиент-сервер или сервер-клиент)
            const direction = Math.random() > 0.5 ? 'forward' : 'backward';
            const fromDevice = direction === 'forward' ? 'pc' : 'server';
            const toDevice = direction === 'forward' ? 'server' : 'pc';
            
            // Генерация пакета с MAC-адресами
            const packetData = generateRandomPacket(fromDevice, toDevice);
            
            // Очистка и заполнение пакета
            packet.innerHTML = '';
            
            // Добавляем заголовок с MAC-адресами в столбик
            const header = document.createElement('div');
            header.className = 'packet-header';
            header.innerHTML = `
                <div class="mac-row">
                    <span class="mac-label">From:</span>
                    <span class="mac-value">${packetData.fromMac}</span>
                </div>
                <div class="mac-row">
                    <span class="mac-label">To:</span>
                    <span class="mac-value">${packetData.toMac}</span>
                </div>
            `;
            packet.appendChild(header);
            
            // Добавляем биты данных
            const bitsContainer = document.createElement('div');
            bitsContainer.className = 'packet-bits';
            packetData.bits.split('').forEach(bit => {
                const bitElement = document.createElement('div');
                bitElement.className = 'bit';
                bitElement.textContent = bit;
                bitsContainer.appendChild(bitElement);
            });
            packet.appendChild(bitsContainer);
            
            // Сброс состояния пакета
            packet.classList.remove('error');
            
            // Начальная позиция (зависит от направления)
            packet.style.left = direction === 'forward' ? '5%' : '95%';
            packet.style.opacity = '1';
            
            // Случайная ошибка (5% или 20% в режиме ошибок)
            const willError = errorMode ? Math.random() < 0.2 : Math.random() < 0.05;
            
            // Анимация движения
            const startTime = Date.now();
            let progress = 0;
            const positions = direction === 'forward' ? [5, 25, 50, 75, 95] : [95, 75, 50, 25, 5];
            const devicePoints = direction === 'forward' ? [0.25, 0.5, 0.75] : [0.75, 0.5, 0.25];
            
            function movePacket() {
                if (!isRunning) return;
                
                progress += 16; // ~60fps
                const percentage = Math.min(progress / animationSpeed, 1);
                
                // Расчет текущей позиции
                let currentPos;
                if (percentage < 0.25) {
                    currentPos = positions[0] + (percentage / 0.25) * (positions[1] - positions[0]);
                } else if (percentage < 0.5) {
                    currentPos = positions[1] + ((percentage - 0.25) / 0.25) * (positions[2] - positions[1]);
                } else if (percentage < 0.75) {
                    currentPos = positions[2] + ((percentage - 0.5) / 0.25) * (positions[3] - positions[2]);
                } else {
                    currentPos = positions[3] + ((percentage - 0.75) / 0.25) * (positions[4] - positions[3]);
                }
                
                packet.style.left = `${currentPos}%`;
                
                // Проверка на отключенные устройства
                let blocked = false;
                devicePoints.forEach((point, i) => {
                    const device = ['switch', 'router', 'firewall'][i];
                    if (disabledDevices.includes(device) && percentage >= point - 0.05 && percentage <= point + 0.05) {
                        blocked = true;
                    }
                });
                
                // Эффект "подпрыгивания" при прохождении устройств
                let jumpHeight = 0;
                devicePoints.forEach(point => {
                    const dist = Math.abs(percentage - point);
                    if (dist < 0.1) {
                        jumpHeight = Math.sin((dist * 10) * Math.PI) * 30;
                    }
                });
                
                packet.style.transform = `translateY(calc(-50% - ${jumpHeight}px))`;
                
                // Обработка завершения или ошибки
                if (blocked || (willError && percentage > 0.7)) {
                    // Пакет не дошел
                    packet.style.opacity = '0';
                    
                    if (blocked || willError) {
                        packet.classList.add('error');
                        const bits = packet.querySelectorAll('.bit');
                        bits.forEach(bit => bit.classList.add('error'));
                        errorCount++;
                        stats.errors.textContent = errorCount;
                        showPacketInfo(packetData, 'Ошибка передачи', Date.now() - startTime);
                    } else {
                        showPacketInfo(packetData, 'Заблокирован устройством', Date.now() - startTime);
                    }
                    
                    totalPacketsSent++;
                    stats.packetsSent.textContent = totalPacketsSent;
                    
                    // Запуск следующей анимации
                    setTimeout(() => animatePacket(packet), 500);
                } else if (percentage >= 1) {
                    // Пакет дошел
                    packet.style.opacity = '0';
                    totalPacketsSent++;
                    totalPacketsReceived++;
                    stats.packetsSent.textContent = totalPacketsSent;
                    stats.packetsReceived.textContent = totalPacketsReceived;
                    speedCount++;
                    
                    // Задержка
                    const latency = Date.now() - startTime;
                    stats.latency.textContent = latency;
                    
                    // Показать информацию о успешной передаче
                    showPacketInfo(packetData, 'Успешно доставлен', latency);
                    
                    // Запуск следующей анимации
                    setTimeout(() => animatePacket(packet), 500);
                } else {
                    requestAnimationFrame(movePacket);
                }
            }
            
            movePacket();
        }
        
        // Запуск передачи
        function startTransmission() {
            if (isRunning) return;
            isRunning = true;
            
            // Запуск анимации для всех пакетов
            packets.forEach((packet, i) => {
                setTimeout(() => animatePacket(packet), i * (animationSpeed / packets.length));
            });
            
            // Статистика скорости
            speedInterval = setInterval(() => {
                stats.speed.textContent = speedCount;
                speedCount = 0;
            }, 1000);
        }
        
        // Остановка передачи
        function stopTransmission() {
            isRunning = false;
            clearInterval(speedInterval);
            packets.forEach(packet => {
                packet.style.opacity = '0';
            });
        }
        
        // События
        startBtn.addEventListener('click', startTransmission);
        stopBtn.addEventListener('click', stopTransmission);
        
        // Выбор типа соединения
        connectionBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                connectionBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                updateConnectionType(btn.dataset.type);
            });
        });
        
        // Закрытие информации о пакете
        closeInfo.addEventListener('click', () => {
            packetInfo.style.display = 'none';
            if (currentPacketInfo) {
                clearTimeout(currentPacketInfo);
                currentPacketInfo = null;
            }
        });
        
        // Инициализация
        packets.forEach(packet => {
            packet.style.top = '50%';
        });
    </script>
</body>
</html>