<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö —Å MAC-–∞–¥—Ä–µ—Å–∞–º–∏</title>
    <style>
        :root {
            --primary: #00ffaa;
            --secondary: #0099ff;
            --error: #ff3366;
            --bg-dark: #0f0f1a;
            --device-bg: #1a1a2e;
            --disabled: #33334a;
            --fiber-color: #ff9900;
            --utp-color: #0099ff;
            --mac-color: #aa00ff;
            --header-bg: rgba(0, 0, 0, 0.3);
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--bg-dark);
            color: white;
            overflow-x: hidden;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(0, 255, 170, 0.3);
        }
        .subtitle {
            color: var(--secondary);
            font-size: 1.2rem;
        }
        .network-container {
            position: relative;
            height: 400px;
            margin: 50px 0;
            perspective: 1000px;
        }
        .network-rail {
            position: absolute;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, #252540, #3a3a5a);
            top: 50%;
            transform: translateY(-50%);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 153, 255, 0.2);
            transition: all 0.3s;
        }
        .network-rail.fiber {
            background: linear-gradient(90deg, #3a2a00, #5a4a20);
            box-shadow: 0 0 20px rgba(255, 153, 0, 0.3);
        }
        .device {
            position: absolute;
            width: 170px;
            height: 130px;
            background: var(--device-bg);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
            z-index: 10;
            border: 2px solid #2a2a4a;
            cursor: pointer;
        }
        .device:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 153, 255, 0.3);
        }
        .device.disabled {
            background: var(--disabled);
            opacity: 0.6;
            border-color: var(--error);
        }
        .device.disabled .device-icon {
            opacity: 0.5;
        }
        .device-icon {
            font-size: 40px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        .device-label {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .device-mac {
            font-size: 12px;
            color: var(--mac-color);
            font-family: monospace;
            margin-top: 5px;
        }
        .packet {
            position: absolute;
            width: 100px;
            height: 80px;
            background: rgba(0, 255, 170, 0.2);
            border-radius: 8px;
            border: 2px solid var(--primary);
            z-index: 5;
            opacity: 0;
            display: flex;
            flex-direction: column;
            padding: 0;
            box-shadow: 0 0 20px rgba(0, 255, 170, 0.3);
            transition: left 0.5s linear;
            overflow: hidden;
        }
        .packet.error {
            border-color: var(--error);
            box-shadow: 0 0 20px rgba(255, 51, 102, 0.3);
        }
        .packet-header {
            background: var(--header-bg);
            padding: 5px;
            font-size: 9px;
            color: var(--mac-color);
            font-family: monospace;
            display: flex;
            flex-direction: column;
            gap: 2px;
            border-bottom: 1px solid var(--primary);
        }
        .mac-row {
            display: flex;
            align-items: center;
        }
        .mac-label {
            width: 30px;
            color: var(--primary);
            font-weight: bold;
        }
        .mac-value {
            flex-grow: 1;
        }
        .packet-bits {
            display: flex;
            justify-content: center;
            gap: 3px;
            padding: 5px;
            flex-wrap: wrap;
        }
        .bit {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            font-weight: bold;
            color: black;
        }
        .bit.error {
            background: var(--error);
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        .btn {
            padding: 15px 30px;
            border-radius: 50px;
            border: none;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .btn-primary {
            background: var(--primary);
            color: #111;
            box-shadow: 0 5px 15px rgba(0, 255, 170, 0.4);
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 255, 170, 0.6);
        }
        .btn-secondary {
            background: transparent;
            color: var(--secondary);
            border: 2px solid var(--secondary);
        }
        .btn-secondary:hover {
            background: rgba(0, 153, 255, 0.1);
        }
        .btn-danger {
            background: transparent;
            color: var(--error);
            border: 2px solid var(--error);
        }
        .btn-danger:hover {
            background: rgba(255, 51, 102, 0.1);
        }
        .connection-type {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .connection-btn {
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 153, 255, 0.1);
            color: var(--secondary);
            border: 2px solid var(--secondary);
        }
        .connection-btn.active {
            background: var(--secondary);
            color: #111;
        }
        .connection-btn.fiber {
            color: var(--fiber-color);
            border: 2px solid var(--fiber-color);
        }
        .connection-btn.fiber.active {
            background: var(--fiber-color);
            color: #111;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            background: rgba(26, 26, 46, 0.7);
            padding: 20px;
            border-radius: 15px;
            margin-top: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid #2a2a4a;
            flex-wrap: wrap;
        }
        .stat {
            text-align: center;
            min-width: 150px;
            margin: 10px;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stat-label {
            color: #a0a0c0;
            font-size: 14px;
        }
        .pulse-effect {
            position: absolute;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, transparent, var(--secondary), transparent);
            top: 0;
            opacity: 0;
            animation: pulse 4s infinite;
        }
        .pulse-effect.fiber {
            background: linear-gradient(90deg, transparent, var(--fiber-color), transparent);
            animation: pulse 2s infinite;
        }
        .device-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .device-btn {
            padding: 10px 20px;
            border-radius: 30px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 153, 255, 0.1);
            color: var(--secondary);
            border: 2px solid var(--secondary);
        }
        .device-btn.active {
            background: var(--secondary);
            color: #111;
        }
        .device-btn.disabled-btn {
            border-color: var(--error);
            color: var(--error);
        }
        .device-btn.disabled-btn.active {
            background: var(--error);
            color: #111;
        }
        @keyframes pulse {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 0.7; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .pc { left: 5%; top: 50%; transform: translateY(-50%); }
        .switch { left: 25%; top: 50%; transform: translateY(-50%); }
        .router { left: 50%; top: 50%; transform: translateY(-50%); }
        .firewall { left: 75%; top: 50%; transform: translateY(-50%); }
        .server { left: 95%; top: 50%; transform: translateY(-50%); }
        
        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–∫–µ—Ç–µ */
        .packet-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(26, 26, 46, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--secondary);
            max-width: 300px;
            z-index: 100;
        }
        .packet-info h3 {
            margin-top: 0;
            color: var(--primary);
        }
        .packet-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        .close-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–ë–∏—Ç—ã –∏ –∫–∞–¥—Ä—ã</h1>
        </header>
        
        <div class="connection-type">
            <button class="connection-btn active" data-type="utp">–í–∏—Ç–∞—è –ø–∞—Ä–∞ (UTP)</button>
            <button class="connection-btn fiber" data-type="fiber">–û–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–æ</button>
        </div>
        
        <div class="device-controls">
            <button class="device-btn" data-device="switch">–ö–æ–º–º—É—Ç–∞—Ç–æ—Ä</button>
            <button class="device-btn" data-device="router">–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä</button>
            <button class="device-btn" data-device="firewall">Firewall</button>
            <button class="device-btn disabled-btn" data-device="error">–†–µ–∂–∏–º –æ—à–∏–±–æ–∫</button>
        </div>
        
        <div class="network-container">
            <div class="network-rail" id="networkRail">
                <div class="pulse-effect" id="pulseEffect"></div>
            </div>
            
            <!-- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å MAC-–∞–¥—Ä–µ—Å–∞–º–∏ -->
            <div class="device pc" data-device="pc">
                <div class="device-icon">üíª</div>
                <div class="device-label">–ö–õ–ò–ï–ù–¢</div>
                <div class="device-mac">MAC: 00:1A:2B:3C:4D:5E</div>
            </div>
            
            <div class="device switch" data-device="switch">
                <div class="device-icon">üîÄ</div>
                <div class="device-label">–ö–û–ú–ú–£–¢–ê–¢–û–†</div>
                <div class="device-mac">MAC: 00:1A:2B:3C:4D:5F</div>
            </div>
            
            <div class="device router" data-device="router">
                <div class="device-icon">üîÑ</div>
                <div class="device-label">–ú–ê–†–®–†–£–¢–ò–ó–ê–¢–û–†</div>
                <div class="device-mac">MAC: 00:1A:2B:3C:4D:60</div>
            </div>
            
            <div class="device firewall" data-device="firewall">
                <div class="device-icon">üõ°Ô∏è</div>
                <div class="device-label">FIREWALL</div>
                <div class="device-mac">MAC: 00:1A:2B:3C:4D:61</div>
            </div>
            
            <div class="device server" data-device="server">
                <div class="device-icon">üñ•Ô∏è</div>
                <div class="device-label">–°–ï–†–í–ï–†</div>
                <div class="device-mac">MAC: 00:1A:2B:3C:4D:62</div>
            </div>
            
            <!-- –ü–∞–∫–µ—Ç—ã -->
            <div class="packet" id="packet1"></div>
            <div class="packet" id="packet2"></div>
            <div class="packet" id="packet3"></div>
        </div>
        
        <div class="controls">
            <button class="btn btn-primary" id="startBtn">
                <span>‚ñ∂Ô∏è</span> –ó–ê–ü–£–°–¢–ò–¢–¨ –ü–ï–†–ï–î–ê–ß–£
            </button>
            <button class="btn btn-secondary" id="stopBtn">
                <span>‚èπÔ∏è</span> –û–°–¢–ê–ù–û–í–ò–¢–¨
            </button>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="packetsSent">0</div>
                <div class="stat-label">–ü–ê–ö–ï–¢–û–í –û–¢–ü–†–ê–í–õ–ï–ù–û</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="packetsReceived">0</div>
                <div class="stat-label">–ü–ê–ö–ï–¢–û–í –ü–û–õ–£–ß–ï–ù–û</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="speed">0</div>
                <div class="stat-label">–ü–ê–ö–ï–¢–û–í/–°–ï–ö</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="errors">0</div>
                <div class="stat-label">–û–®–ò–ë–û–ö</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="latency">0</div>
                <div class="stat-label">–ó–ê–î–ï–†–ñ–ö–ê (–ú–°)</div>
            </div>
        </div>
        
        <!-- –ë–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–∫–µ—Ç–µ -->
        <div class="packet-info" id="packetInfo" style="display: none;">
            <button class="close-btn" id="closeInfo">√ó</button>
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–∫–µ—Ç–µ</h3>
            <p><strong>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:</strong> <span id="info-from">-</span></p>
            <p><strong>–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</strong> <span id="info-to">-</span></p>
            <p><strong>–î–∞–Ω–Ω—ã–µ:</strong> <span id="info-bits">-</span></p>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="info-status">-</span></p>
            <p><strong>–í—Ä–µ–º—è –ø–µ—Ä–µ–¥–∞—á–∏:</strong> <span id="info-time">-</span> –º—Å</p>
        </div>
    </div>

    <script>
        // MAC-–∞–¥—Ä–µ—Å–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        const macAddresses = {
            pc: '00:1A:2B:3C:4D:5E',
            switch: '00:1A:2B:3C:4D:5F',
            router: '00:1A:2B:3C:4D:60',
            firewall: '00:1A:2B:3C:4D:61',
            server: '00:1A:2B:3C:4D:62'
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const connectionBtns = document.querySelectorAll('.connection-btn');
        const deviceBtns = document.querySelectorAll('.device-btn');
        const packets = [
            document.getElementById('packet1'),
            document.getElementById('packet2'),
            document.getElementById('packet3')
        ];
        const devices = {
            pc: document.querySelector('.pc'),
            switch: document.querySelector('.switch'),
            router: document.querySelector('.router'),
            firewall: document.querySelector('.firewall'),
            server: document.querySelector('.server')
        };
        const networkRail = document.getElementById('networkRail');
        const pulseEffect = document.getElementById('pulseEffect');
        const stats = {
            packetsSent: document.getElementById('packetsSent'),
            packetsReceived: document.getElementById('packetsReceived'),
            speed: document.getElementById('speed'),
            errors: document.getElementById('errors'),
            latency: document.getElementById('latency')
        };
        const packetInfo = document.getElementById('packetInfo');
        const closeInfo = document.getElementById('closeInfo');
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ
        let isRunning = false;
        let connectionType = 'utp';
        let errorMode = false;
        let disabledDevices = [];
        let totalPacketsSent = 0;
        let totalPacketsReceived = 0;
        let errorCount = 0;
        let speedCount = 0;
        let animationSpeed = 5000; // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –∑–∞–º–µ–¥–ª–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
        let animationInterval;
        let speedInterval;
        let currentPacketInfo = null;
        
        // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ —Å MAC-–∞–¥—Ä–µ—Å–∞–º–∏
        function generateRandomPacket(fromDevice, toDevice) {
            const packetLength = 5 + Math.floor(Math.random() * 3); // 5-7 –±–∏—Ç
            let packetBits = '';
            
            for (let i = 0; i < packetLength; i++) {
                packetBits += Math.random() > 0.5 ? '1' : '0';
            }
            
            return {
                fromMac: macAddresses[fromDevice],
                toMac: macAddresses[toDevice],
                bits: packetBits,
                fromDevice: fromDevice,
                toDevice: toDevice
            };
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞–∫–µ—Ç–µ
        function showPacketInfo(packetData, status, time) {
            document.getElementById('info-from').textContent = `${devices[packetData.fromDevice].querySelector('.device-label').textContent} (${packetData.fromMac})`;
            document.getElementById('info-to').textContent = `${devices[packetData.toDevice].querySelector('.device-label').textContent} (${packetData.toMac})`;
            document.getElementById('info-bits').textContent = packetData.bits;
            document.getElementById('info-status').textContent = status;
            document.getElementById('info-time').textContent = time;
            packetInfo.style.display = 'block';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            currentPacketInfo = setTimeout(() => {
                packetInfo.style.display = 'none';
            }, 5000);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        function updateConnectionType(type) {
            connectionType = type;
            
            if (type === 'fiber') {
                networkRail.classList.add('fiber');
                pulseEffect.classList.add('fiber');
                animationSpeed = 3000; // –û–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–æ –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–æ
            } else {
                networkRail.classList.remove('fiber');
                pulseEffect.classList.remove('fiber');
                animationSpeed = 5000; // UTP –º–µ–¥–ª–µ–Ω–Ω–µ–µ
            }
            
            if (isRunning) {
                stopTransmission();
                startTransmission();
            }
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
        deviceBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const device = btn.dataset.device;
                
                if (device === 'error') {
                    errorMode = !errorMode;
                    btn.classList.toggle('active');
                    return;
                }
                
                if (disabledDevices.includes(device)) {
                    disabledDevices = disabledDevices.filter(d => d !== device);
                    devices[device].classList.remove('disabled');
                    btn.classList.remove('active');
                } else {
                    disabledDevices.push(device);
                    devices[device].classList.add('disabled');
                    btn.classList.add('active');
                }
            });
        });
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞
        function animatePacket(packet) {
            if (!isRunning) return;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä-–∫–ª–∏–µ–Ω—Ç)
            const direction = Math.random() > 0.5 ? 'forward' : 'backward';
            const fromDevice = direction === 'forward' ? 'pc' : 'server';
            const toDevice = direction === 'forward' ? 'server' : 'pc';
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞ —Å MAC-–∞–¥—Ä–µ—Å–∞–º–∏
            const packetData = generateRandomPacket(fromDevice, toDevice);
            
            // –û—á–∏—Å—Ç–∫–∞ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞
            packet.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å MAC-–∞–¥—Ä–µ—Å–∞–º–∏ –≤ —Å—Ç–æ–ª–±–∏–∫
            const header = document.createElement('div');
            header.className = 'packet-header';
            header.innerHTML = `
                <div class="mac-row">
                    <span class="mac-label">From:</span>
                    <span class="mac-value">${packetData.fromMac}</span>
                </div>
                <div class="mac-row">
                    <span class="mac-label">To:</span>
                    <span class="mac-value">${packetData.toMac}</span>
                </div>
            `;
            packet.appendChild(header);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö
            const bitsContainer = document.createElement('div');
            bitsContainer.className = 'packet-bits';
            packetData.bits.split('').forEach(bit => {
                const bitElement = document.createElement('div');
                bitElement.className = 'bit';
                bitElement.textContent = bit;
                bitsContainer.appendChild(bitElement);
            });
            packet.appendChild(bitsContainer);
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–∞–∫–µ—Ç–∞
            packet.classList.remove('error');
            
            // –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
            packet.style.left = direction === 'forward' ? '5%' : '95%';
            packet.style.opacity = '1';
            
            // –°–ª—É—á–∞–π–Ω–∞—è –æ—à–∏–±–∫–∞ (5% –∏–ª–∏ 20% –≤ —Ä–µ–∂–∏–º–µ –æ—à–∏–±–æ–∫)
            const willError = errorMode ? Math.random() < 0.2 : Math.random() < 0.05;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
            const startTime = Date.now();
            let progress = 0;
            const positions = direction === 'forward' ? [5, 25, 50, 75, 95] : [95, 75, 50, 25, 5];
            const devicePoints = direction === 'forward' ? [0.25, 0.5, 0.75] : [0.75, 0.5, 0.25];
            
            function movePacket() {
                if (!isRunning) return;
                
                progress += 16; // ~60fps
                const percentage = Math.min(progress / animationSpeed, 1);
                
                // –†–∞—Å—á–µ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
                let currentPos;
                if (percentage < 0.25) {
                    currentPos = positions[0] + (percentage / 0.25) * (positions[1] - positions[0]);
                } else if (percentage < 0.5) {
                    currentPos = positions[1] + ((percentage - 0.25) / 0.25) * (positions[2] - positions[1]);
                } else if (percentage < 0.75) {
                    currentPos = positions[2] + ((percentage - 0.5) / 0.25) * (positions[3] - positions[2]);
                } else {
                    currentPos = positions[3] + ((percentage - 0.75) / 0.25) * (positions[4] - positions[3]);
                }
                
                packet.style.left = `${currentPos}%`;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                let blocked = false;
                devicePoints.forEach((point, i) => {
                    const device = ['switch', 'router', 'firewall'][i];
                    if (disabledDevices.includes(device) && percentage >= point - 0.05 && percentage <= point + 0.05) {
                        blocked = true;
                    }
                });
                
                // –≠—Ñ—Ñ–µ–∫—Ç "–ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞–Ω–∏—è" –ø—Ä–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                let jumpHeight = 0;
                devicePoints.forEach(point => {
                    const dist = Math.abs(percentage - point);
                    if (dist < 0.1) {
                        jumpHeight = Math.sin((dist * 10) * Math.PI) * 30;
                    }
                });
                
                packet.style.transform = `translateY(calc(-50% - ${jumpHeight}px))`;
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–ª–∏ –æ—à–∏–±–∫–∏
                if (blocked || (willError && percentage > 0.7)) {
                    // –ü–∞–∫–µ—Ç –Ω–µ –¥–æ—à–µ–ª
                    packet.style.opacity = '0';
                    
                    if (blocked || willError) {
                        packet.classList.add('error');
                        const bits = packet.querySelectorAll('.bit');
                        bits.forEach(bit => bit.classList.add('error'));
                        errorCount++;
                        stats.errors.textContent = errorCount;
                        showPacketInfo(packetData, '–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏', Date.now() - startTime);
                    } else {
                        showPacketInfo(packetData, '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º', Date.now() - startTime);
                    }
                    
                    totalPacketsSent++;
                    stats.packetsSent.textContent = totalPacketsSent;
                    
                    // –ó–∞–ø—É—Å–∫ —Å–ª–µ–¥—É—é—â–µ–π –∞–Ω–∏–º–∞—Ü–∏–∏
                    setTimeout(() => animatePacket(packet), 500);
                } else if (percentage >= 1) {
                    // –ü–∞–∫–µ—Ç –¥–æ—à–µ–ª
                    packet.style.opacity = '0';
                    totalPacketsSent++;
                    totalPacketsReceived++;
                    stats.packetsSent.textContent = totalPacketsSent;
                    stats.packetsReceived.textContent = totalPacketsReceived;
                    speedCount++;
                    
                    // –ó–∞–¥–µ—Ä–∂–∫–∞
                    const latency = Date.now() - startTime;
                    stats.latency.textContent = latency;
                    
                    // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —É—Å–ø–µ—à–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–µ
                    showPacketInfo(packetData, '–£—Å–ø–µ—à–Ω–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω', latency);
                    
                    // –ó–∞–ø—É—Å–∫ —Å–ª–µ–¥—É—é—â–µ–π –∞–Ω–∏–º–∞—Ü–∏–∏
                    setTimeout(() => animatePacket(packet), 500);
                } else {
                    requestAnimationFrame(movePacket);
                }
            }
            
            movePacket();
        }
        
        // –ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–¥–∞—á–∏
        function startTransmission() {
            if (isRunning) return;
            isRunning = true;
            
            // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤
            packets.forEach((packet, i) => {
                setTimeout(() => animatePacket(packet), i * (animationSpeed / packets.length));
            });
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏
            speedInterval = setInterval(() => {
                stats.speed.textContent = speedCount;
                speedCount = 0;
            }, 1000);
        }
        
        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏
        function stopTransmission() {
            isRunning = false;
            clearInterval(speedInterval);
            packets.forEach(packet => {
                packet.style.opacity = '0';
            });
        }
        
        // –°–æ–±—ã—Ç–∏—è
        startBtn.addEventListener('click', startTransmission);
        stopBtn.addEventListener('click', stopTransmission);
        
        // –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        connectionBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                connectionBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                updateConnectionType(btn.dataset.type);
            });
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–∫–µ—Ç–µ
        closeInfo.addEventListener('click', () => {
            packetInfo.style.display = 'none';
            if (currentPacketInfo) {
                clearTimeout(currentPacketInfo);
                currentPacketInfo = null;
            }
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        packets.forEach(packet => {
            packet.style.top = '50%';
        });
    </script>
</body>
</html>